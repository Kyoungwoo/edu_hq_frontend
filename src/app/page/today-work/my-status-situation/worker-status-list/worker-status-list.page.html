<ion-header>
  <ion-toolbar color="white">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>근로자 출입 관리</ion-title>
  </ion-toolbar>
</ion-header>
<ion-toolbar slot="top" color="white">
  <app-row>
    <app-col>
      <ion-segment color="primary" [value]="1">
        <ion-segment-button [value]="1" (click)="menuCount = 1">게이트</ion-segment-button>
        <ion-segment-button (click)="menuCount = 2">위험지역</ion-segment-button>
      </ion-segment>
    </app-col>
  </app-row>
</ion-toolbar>
<app-row *ngIf="menuCount === 1">
  <app-col>
    <app-input label="" placeholder="검색어를 입력하세요" [(ngModel)]="form.search_text"></app-input>
  </app-col>
  <app-col size="auto">
    <app-button (click)="getGate()">검색</app-button>
  </app-col>
</app-row>
<ng-container *ngIf="menuCount === 2">
  <app-row>
    <app-col>
      <app-select-dangerous-area (change)="dataChange($event)" [project_id]="form.project_id" [(ngModel)]="form.area_risk_id"></app-select-dangerous-area>
    </app-col>
  </app-row>
  <app-row>
    <app-col>
      <app-input label="" placeholder="검색어를 입력하세요" [(ngModel)]="form.search_text"></app-input>
    </app-col>
    <app-col size="auto">
      <app-button (click)="getRiskArea()">검색</app-button>
    </app-col>
  </app-row>
</ng-container>
<ion-content>
  <ng-container *ngIf="menuCount === 1">
      <ng-container *ngFor="let gate of gateList?.rsMap" >
        <app-card (click)="gate.checked= !gate.checked">
          <app-row>
            <app-col size="auto">
            </app-col>
            <app-col>
              <h5>{{ gate.user_name }}</h5>
              <p>{{ gate.company_name }} | {{ gate.ctgo_job_position_name }} | {{ gate.inside_time }}</p>
            </app-col>
            <app-col size="auto">
              <ion-chip [color]="gate.outside_state ?  'primary' : 'medium'">{{ gate.outside_state ?  '입장' :'퇴장' }}
              </ion-chip>
            </app-col>
            <app-col size="auto">
              <ion-chip [color]="gate.outside_state ?  'primary' : 'medium'">{{ gate.outside_state ? gate.outside_time :gate.inside_time }}<br>{{ gate.inside_state ? '(수동)':''}}</ion-chip>
            </app-col>
          </app-row>
        </app-card>
        <ng-container *ngIf="gate.checked">
          <app-card  *ngFor="let item of gate?.inner_data">
            <app-row >
              <app-col size="auto">
              </app-col>
              <app-col>
              </app-col>
              <app-col size="auto">
                <ion-chip [color]="gate.outside_state ?  'primary' : 'medium'">{{ gate.outside_state ?  '입장' :'퇴장' }}
                </ion-chip>
              </app-col>
              <app-col size="auto">
                <ion-chip [color]="gate.outside_state ?  'primary' : 'medium'">{{ item.outside_state ? item.outside_time :item.inside_time }}</ion-chip>
              </app-col>
            </app-row>
          </app-card>
        </ng-container>
      </ng-container>
    </ng-container>

  <ng-container *ngIf="menuCount === 2">
      <ng-container *ngFor="let risk of riskAreaList?.rsMap" >
        <app-card (click)="risk.checked= !risk.checked">
          <app-row>
            <app-col size="auto">
            </app-col>
            <app-col>
              <h5>{{ risk.user_name }}</h5>
              <p>{{ risk.company_name }} | {{ risk.ctgo_job_position_name }} | {{ risk.inside_time }}</p>
            </app-col>
            <app-col size="auto">
              <ion-chip [color]="risk.outside_state ? 'primary' : 'medium'">{{ risk.outside_state ? '입장' :'퇴장'  }}</ion-chip>
            </app-col>
            <app-col size="auto">
              <ion-chip [color]="risk.outside_state ? 'primary' : 'medium'">{{ risk.outside_state ? risk.outside_time :risk.inside_time }}<br>{{ risk.inside_state ? '(수동)':''}}</ion-chip>
            </app-col>
          </app-row>
        </app-card>
        <ng-container *ngIf="risk.checked">
          <app-card  *ngFor="let item of risk?.inner_data">
            <app-row>
              <app-col size="auto">
              </app-col>
              <app-col>
              </app-col>
              <app-col size="auto">
                <ion-chip [color]="item.outside_state ? 'primary' : 'medium'">{{ item.outside_state ? '입장' :'퇴장'  }}</ion-chip>
              </app-col>
              <app-col size="auto">
                <ion-chip [color]="item.outside_state ? 'primary' : 'medium'">{{ item.outside_state ? item.outside_time :item.inside_time }}</ion-chip>
              </app-col>
            </app-row>
          </app-card>
        </ng-container>
      </ng-container>
    </ng-container>
  </ion-content>
  <app-button *ngIf="menuCount === 2 && nfcIn" (click)="inNfcQr()">장소 스캔(NFC/QR)</app-button>
  <!-- *ngIf="menuCount === 1 || !nfcIn" -->
  <app-button-footer *ngIf="menuCount === 1 || (menuCount === 2 && !nfcIn)">
  <app-button (click)="work_edit('IN')">근로자 입장 등록</app-button>
  <app-button (click)="work_edit('OUT')" >근로자 퇴장 등록</app-button>
</app-button-footer>
