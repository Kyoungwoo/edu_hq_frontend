
<ion-header>
  <ion-toolbar color="white">
    <ion-title>협력사 정보</ion-title>
    <ion-buttons slot="end">
      <app-dismiss-button></app-dismiss-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <h4>협력사 정보</h4>
  <form>
    <app-row>
      <app-col>
        <app-select-company name="input" label="업체명" [type]="true" [(ngModel)]="resObj.company_name" placeholder="업체명"></app-select-company>
      </app-col>
      <app-col>
        <app-input name="input buisnessman" [disabled]="true" label="사업자등록번호" [(ngModel)]="resObj.business_register_no" placeholder="사업자등록번호"></app-input>
      </app-col>
      <app-col>
        <app-input name="input buisnessman" [disabled]="true" label="대표자" [(ngModel)]="resObj.company_ceo"  placeholder="대표자"></app-input>
      </app-col>
      <app-col>
        <app-input name="input" label="회사전화" [readonly]="this.updateStatus" [(ngModel)]="resObj.company_phone" placeholder="회사전화"></app-input>
      </app-col>
    </app-row>
    <app-row>
    </app-row>
  </form>
<app-row>
  <app-col>
    <h4>계약 정보</h4>
  </app-col>
  <app-col size="auto">
    <app-button style="margin-bottom: 0;" (click)="addContractInfo()" fill="translucent">추가</app-button>
    <app-button style="margin-top: 0;" (click)="selectDelete()" color="danger" fill="translucent">삭제</app-button>
  </app-col>
</app-row>
<app-check-group [(ngModel)]="selectList">
  <app-table>
    <thead>
      <tr>
        <th style="width: 40px;">
          <app-check type="all"></app-check>
        </th>
        <th>현장명</th>
        <th>원청사명</th>
        <th>계약명</th>
        <th>계약공종</th>
        <th>계약금액<br>(원/VAT 별도)</th>
        <th style="width: 280px;">계약기간</th>
        <th style="width: 130px;">협력사 소장</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of resMap let i = index" >
        <td>
          <app-check [on]="i"></app-check>
        </td>
        <td><app-select-scene [(ngModel)]="item.project_id"></app-select-scene></td>
        <td><app-select-contractor [(ngModel)]="item.master_company_id"></app-select-contractor></td>
        <td><app-input [(ngModel)]="item.contract_name"></app-input></td>
        <td>
          <app-select [(ngModel)]="item.ctgo_construction_id">
            <app-select-option *ngFor="let opt of this.res.rsMap" [value]="opt.ctgo_construction_id">{{ opt.ctgo_construction_name }}</app-select-option>
          </app-select>
        </td>
        <td><app-input [(ngModel)]="item.contract_amount"></app-input></td>
        <td>
          <app-input-group>
            <app-calendar [(ngModel)]="item.contract_start_date"></app-calendar>
            ~
            <app-calendar [(ngModel)]="item.contract_end_date"></app-calendar>
          </app-input-group>
        </td>
        <td><app-select-people [(ngModel)]="item.master_company_id"></app-select-people></td>
      </tr>
      <ng-container *ngFor="let data of res?.rsMap let i = index">
        <tr *ngIf="data.checked">
          <td>{{ data.project_id }}</td>
          <td>{{ data.master_company_id }}</td>
          <td>{{ data.contract_name}}</td>
          <td>{{ data.ctgo_construction_id}}</td>
          <td>{{ data.contract_amount}}</td>
          <td>{{ data.contract_start_date}}~{{ data.contract_end_date}}</td>
          <td>{{ data.master_company_id}}</td>
          <td style="width: 40px;"><app-button (click)="data.checked = false" size="small" color="danger"><ion-icon name="close-outline"></ion-icon></app-button></td>
        </tr>
      </ng-container>
    </tbody>
  </app-table>
</app-check-group>
<h4>담당자 정보</h4>
<app-row>
  <app-col>
    <app-input name="name" [readonly]="this.updateStatus" [(ngModel)]="resObj.manager_name" label="성명"></app-input>
  </app-col>
  <app-col>
    <app-input name="phoneNumber" [readonly]="this.updateStatus" [(ngModel)]="resObj.manager_phone" [type]="'tel'" label="연락처"></app-input>
  </app-col>
  <app-col>
    <app-input *ngIf="updateStatus else not_id" label="이메일" type="email" [(ngModel)]="resObj.manager_email">
    </app-input>
    <ng-template #not_id>
      <app-input-group label="이메일">
        <app-input [(ngModel)]="email" placeholder="입력"></app-input>
        @
        <app-input placeholder="직접입력" *ngIf="emailaddress === '직접입력'" [readonly]="emailaddress === '직접입력' ? false : true" [(ngModel)]="directlyInput"></app-input>
        <app-input placeholder="직접입력" *ngIf="emailaddress !== '직접입력'" [readonly]="emailaddress !== '직접입력' ? false : true" [(ngModel)]="emailaddress"></app-input>
        <app-select [(ngModel)]="emailaddress" placeholder="선택">
          <app-select-option value="직접입력">직접입력</app-select-option>
          <app-select-option value="lh.or.kr">lh.or.kr</app-select-option>
          <app-select-option value="gmail.com">gmail.com</app-select-option>
          <app-select-option value="naver.com">naver.com</app-select-option>
          <app-select-option value="hanmail.net">hanmail.net</app-select-option>
        </app-select>
      </app-input-group>
    </ng-template>
  </app-col>
</app-row>
<h4>개인정보 처리 위탁 동의</h4>
<app-row>
  <app-col>
    <app-input name="consigner" [(ngModel)]="resObj.company_name"  label="위탁자"></app-input>
  </app-col>
  <app-col>
    <app-input name="fiduciary" value="한국토지주택공사" label="수탁자"></app-input>
  </app-col>
  <app-col>
    <app-input name="consent" [(ngModel)]="resObj.consignee_consent_date" label="동의현황" [type]="'email'"></app-input>
  </app-col>
</app-row>
<app-row>
  <app-col>
    <app-card>
      <span class="font-height">
        <h3 style="text-align: center;">개인정보 처리 위탁 동의서</h3>
        산업안전보건법 시행규칙 제 79 조 (협의체 구성 및 운영)<br>
        1. 작업의 시작 시간<br>
        2. 작업 또는 작업장 간의 연락방법<br>
        3. 재해발생 위험이 있는 경우 대피방법<br>
        4. 작업장에서의 법 제36조에 따른 위험성평가의 실시에 관한 사항<br>
        5. 사업주와 수급인 또는 수급인 상호 간의 연락 방법 및 작업공정의 조정
      </span>
    </app-card>
    <app-button style="width:100%" (click)="agreement()">동의합니다</app-button>
  </app-col>
</app-row>
</ion-content>
<app-button-footer *ngIf="!savestatus">
  <app-button fill="translucent" *ngIf="updateStatus" (click)="contUpdate()">수정</app-button>
  <app-button fill="translucent" color="danger" *ngIf="!updateStatus" (click)="contDelete()" >삭제</app-button>
  <app-button *ngIf="!updateStatus" (click)="contSave()">저장</app-button>
</app-button-footer>
<app-button-footer *ngIf="savestatus">
  <app-button *ngIf="!updateStatus" (click)="contSave()">저장</app-button>
</app-button-footer>    