<ion-header>
  <ion-toolbar color="white">
    <ion-title>현장{{title}}</ion-title>
    <ion-buttons slot="end">
      <app-dismiss-button></app-dismiss-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <h4>현장 개요</h4>
  <app-card>
    <app-row mobileBreak style="border-bottom: 1px solid var(--ion-color-step-100);">
      <app-col>
        <app-input (click)="organizationSel()" [(ngModel)]="organization.name" [readonly]="true" label="조직기구">
          <app-img name="search"></app-img>
        </app-input>
      </app-col>
      <app-col>
        <app-input [(ngModel)]="form.project_name" label="현장명"></app-input>
      </app-col>
    </app-row>
    <app-row mobileBreak>
      <app-col>
        <app-row>
          <app-col>
<<<<<<< HEAD
            <app-select-contractor [multiple]="false" [type]="true" [(ngModel)]="contractor_id"></app-select-contractor>
=======
            <app-select-contractor [multifull]="true" [type]="true" [(ngModel)]="contractor_id"></app-select-contractor>
>>>>>>> c6c246f08c864bdf2ad042966ff24a3764e8b890
          </app-col>
        </app-row>
      </app-col>
      <app-col>
        <app-row>
          <app-col>
            <app-select-supervision [(ngModel)]="supervision_id"></app-select-supervision>
          </app-col>
        </app-row>
      </app-col>
    </app-row>
    <app-row mobileBreak>
      <app-col style="display: flex;align-items: baseline;">
        <app-calendar [(ngModel)]="form.contract_start_date" style="width: 100%;" [max]="form.contract_end_date"></app-calendar>
        <span>&nbsp;~&nbsp;</span>
        <app-calendar [(ngModel)]="form.contract_end_date" style="width: 100%;" [min]="form.contract_start_date"></app-calendar>
      </app-col>
      <app-col>
        <app-input [(ngModel)]="form.construction_amount" label="공사금액"></app-input>
      </app-col>
    </app-row>
    <app-row mobileBreak>
      <app-col>
        <app-select [(ngModel)]="form.ctgo_business_field_id" label="사업분야">
          <app-select-option *ngFor="let opt of ctgo_Business" [value]="opt.ctgo_business_field_id"> {{ opt.ctgo_business_field_name }}</app-select-option>
        </app-select>
      </app-col>
      <app-col>
        <app-input [(ngModel)]="form.construction_content" label="공사내용"></app-input>
      </app-col>
    </app-row>
    <app-row mobileBreak>
      <app-col size="1">
        <app-input [readonly]="true" [(ngModel)]="form.project_postal_code"  label="우편번호"></app-input>
      </app-col>
      <app-col size="2">
        <app-input [readonly]="true" [(ngModel)]="form.project_address" (click)="address()" label="주소"></app-input>
      </app-col>
      <app-col size="3">
        <app-input [(ngModel)]="form.project_detail_address" label="상세주소"></app-input>
      </app-col>
      <app-col>
        <app-input [(ngModel)]="form.gps_state_con" 
         [readonly]="true" (click)="project_area_set()" label="현장 영역"></app-input>
      </app-col>
    </app-row>
  </app-card>

  <app-card>
    <app-row style="align-items: flex-start;">
      <app-col>
          <app-row>
            <app-col>
              <h5>조감도</h5>
            </app-col>
            <app-col size="auto">
              <app-button>추가
                <app-file name="input" view_type="BIRDSEYE"
                [(ngModel)]="form.project_file_data"
                [file]="form.file"
                [file_json]="form.file_json"
                ></app-file>
              </app-button>
            </app-col>
          </app-row>
        <app-table>
          <tr *ngFor="let item of form.project_file_data let i = index">
            <td *ngIf="item.view_type==='BIRDSEYE'">
              <app-row>
                <app-col>
                  <a [href]="item.full_url" target="_blank" [download]="item.file_name">
                    <ion-icon name="save-outline"></ion-icon>
                    {{ item.file_name }}
                  </a>
                </app-col>
              </app-row>
              <ion-row
              *ngIf="item.content_type.startsWith('image')">
                <ion-col>
                  <div class="image-detail">이미지 미리보기</div>
                  <app-img class="image-class" [src]="item.full_url"></app-img>
                </ion-col>
              </ion-row>
            </td>
          </tr>
        </app-table>
      </app-col>
      <app-col>
          <app-row>
            <app-col>
              <h5>조직도</h5>
            </app-col>
            <app-col size="auto">
              <app-button>추가
                <app-file name="input" view_type="FLOOR"
                [(ngModel)]="form.project_file_data"
                [file]="form.file"
                [file_json]="form.file_json"
                ></app-file>
              </app-button>
            </app-col>
          </app-row>
        <app-table>
          <tr *ngFor="let item of form.project_file_data let i = index">
            <td *ngIf="item.view_type==='FLOOR'">
              <app-row>
                <app-col>
                  <a [href]="item.full_url" target="_blank" [download]="item.file_name">
                    <ion-icon name="save-outline"></ion-icon>
                    {{ item.file_name }}
                  </a>
                </app-col>
              </app-row>
              <ion-row
              *ngIf="item.content_type.startsWith('image')">
                <ion-col>
                  <div class="image-detail">이미지 미리보기</div>
                  <app-img class="image-class" [src]="item.full_url"></app-img>
                </ion-col>
              </ion-row>
            </td>
          </tr>
        </app-table>
      </app-col>
    </app-row>
  </app-card>

  <h4>작성 정보</h4>
  <app-card>
    <app-row>
      <app-col>
        <app-input [readonly]="true" [value]="today" label="작성일"></app-input>
      </app-col>
      <app-col>
        <app-input [readonly]="true" [value]="user.name" label="작성자"></app-input>
      </app-col>
    </app-row>
  </app-card>
</ion-content>
<app-button-footer>
  <app-button slot="end" *ngIf="!project_id" (click)="sceneInsert()">저장</app-button>
  <app-button slot="end" *ngIf="project_id" (click)="sceneUpdate()">수정</app-button>
</app-button-footer>